<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, deleteDoc, doc, updateDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURAÇÃO DO SEU FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyD-6Dnre57isMMhMVv7X7X1iT7-oy265UU",
            authDomain: "financeirov1.firebaseapp.com",
            projectId: "financeirov1",
            storageBucket: "financeirov1.firebasestorage.app",
            messagingSenderId: "316105672882",
            appId: "1:316105672882:web:f2674aed7bf1e0976ba1ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // VARIÁVEIS GLOBAIS
        let vendas = [], boletos = [], estoque = [], fluxoEntradas = [];
        let canalSelecionado = 'loja';

        // SINCRONIZAÇÃO EM TEMPO REAL COM O FIREBASE
        window.onload = () => {
            lucide.createIcons();
            const hjStr = new Date().toISOString().split('T')[0];
            document.getElementById('data-inicio').value = hjStr;
            document.getElementById('data-fim').value = hjStr;

            // Escutar Vendas
            onSnapshot(collection(db, "vendas"), (snap) => {
                vendas = snap.docs.map(d => ({id: d.id, ...d.data()}));
                atualizarVendas();
            });

            // Escutar Estoque
            onSnapshot(collection(db, "estoque"), (snap) => {
                estoque = snap.docs.map(d => ({id: d.id, ...d.data()}));
                atualizarEstoque();
            });

            // Escutar Boletos
            onSnapshot(collection(db, "boletos"), (snap) => {
                boletos = snap.docs.map(d => ({id: d.id, ...d.data()}));
                atualizarBoletos();
            });
        };

        // FUNÇÕES DE REGISTRO NO FIREBASE
        window.registrarVenda = async () => {
            const b = parseFloat(document.getElementById('venda-bruta').value) || 0;
            const c = parseFloat(document.getElementById('venda-cmv').value) || 0;
            const e = parseFloat(document.getElementById('venda-embalagem').value) || 0;
            const t = parseFloat(document.getElementById('venda-taxa-reais').value) || 0;
            if(b === 0) return;
            
            await addDoc(collection(db, "vendas"), {
                canal: canalSelecionado,
                bruto: b,
                lucro: (b - c - e - t),
                data: document.getElementById('data-inicio').value,
                timestamp: Date.now()
            });

            ['venda-bruta','venda-cmv','venda-embalagem','venda-taxa-reais'].forEach(id => document.getElementById(id).value = "");
        };

        window.registrarEstoque = async () => {
            const n = document.getElementById('est-nome').value;
            const f = document.getElementById('est-fornecedor').value.trim() || "Diverso";
            const q = parseFloat(document.getElementById('est-qtd').value) || 0;
            const c = parseFloat(document.getElementById('est-custo').value) || 0;
            if(!n || q === 0) return;

            await addDoc(collection(db, "estoque"), {
                nome: n, fornecedor: f, qtd: q, custo: c, dataEntrada: new Date().toISOString()
            });

            ['est-nome','est-fornecedor','est-qtd','est-custo'].forEach(id => document.getElementById(id).value = "");
        };

        window.registrarBoleto = async () => {
            const n = document.getElementById('boleto-nome').value;
            const v = parseFloat(document.getElementById('boleto-valor').value) || 0;
            const d = document.getElementById('boleto-vencimento').value;
            if(!n || v === 0 || !d) return;

            await addDoc(collection(db, "boletos"), { nome: n, valor: v, venc: d });
            ['boleto-nome','boleto-valor','boleto-vencimento'].forEach(id => document.getElementById(id).value = "");
        };

        // ... Mantenha as funções de interface (showPage, atualizarVendas, atualizarEstoque, etc.) abaixo desta linha ...
        // Elas já estão no seu código e funcionam bem para exibir os dados que virão do Firebase.
    </script>